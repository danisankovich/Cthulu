var app=angular.module("Cthulu",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("/",{url:"/",templateUrl:"views/home.ejs",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"views/login.ejs",controller:"mainCtrl"}).state("register",{url:"/register",templateUrl:"views/register.ejs",controller:"mainCtrl"})}]),app.controller("mainCtrl",function($scope,$state,$http,userService){$(document).ready(function(){userService.getCurrentUser().success(function(data){$scope.currentUser=data}),$scope.login=function(user){$http.post("/users/login",user).success(function(user){$scope.currentUser=user,$("#loginModal").foundation("reveal","close")}).error(function(err){$scope.loginMessage="Incorrect Username/Password Combination"})},$scope.register=function(newUser){$scope.newUser=newUser,$http.post("/users/register",$scope.newUser).success(function(err,data){return err.hasOwnProperty("name")===!0?void sweetAlert("Uh Oh  ",err.message,"error"):err.hasOwnProperty("errmsg")?void sweetAlert("Uh Oh ",newUser.email+" is already registered","error"):($scope.currentUser=err,void $("#loginModal").foundation("reveal","close"))})},$scope.closeLogin=function(){$("#loginModal").foundation("reveal","close")},$scope.loginModal=function(){$("#loginModal").foundation("reveal","open")}})}),app.service("userService",function($http){this.getCurrentUser=function(){return $http.get("/user").success(function(user){return user?user:void 0})}});